apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "powerdns.fullname" . }}-recursor-config
data:
  recursor.conf: |
    local-address=0.0.0.0,::
    include-dir=/etc/powerdns/recursor.d
    local-port=5300
    loglevel={{ .Values.recursor.config.logLevel }}
    default-ttl={{ .Values.recursor.config.defaultTtl}}
    webserver-port=8081
    log-dns-queries={{ .Values.recursor.config.logDnsQueries}}
    log-dns-details={{ .Values.recursor.config.logDnsDetails}}

  pdns.j2: |
    gpgsql-host={{ printf "{{POWERDNS_POSTGRES_HOST}}" }}
    gpgsql-port={{ printf "{{POWERDNS_POSTGRES_PORT}}" }}
    gpgsql-user={{ printf "{{POWERDNS_POSTGRES_USERNAME}}" }}
    gpgsql-dbname={{ printf "{{POWERDNS_POSTGRES_DATABASE}}" }}
    gpgsql-password={{ printf "{{POWERDNS_POSTGRES_PASSSWORD}}" }}

