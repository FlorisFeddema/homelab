apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "powerdns.fullname" . }}-auth-config
data:
  pdns.conf: |
    local-address=0.0.0.0,::
    include-dir=/etc/powerdns/pdns.d
    launch=gpgsql
    dnsupdate=yes
    local-port=5300
    loglevel={{ .Values.auth.config.logLevel }}
    default-ttl={{ .Values.auth.config.defaultTtl}}
    webserver-port=8081
    log-dns-queries={{ .Values.auth.config.logDnsQueries}}
    log-dns-details={{ .Values.auth.config.logDnsDetails}}

  pdns.j2: |
    gpgsql-host={{ printf "{{POWERDNS_POSTGRES_HOST}}" }}
    gpgsql-port={{ printf "{{POWERDNS_POSTGRES_PORT}}" }}
    gpgsql-user={{ printf "{{POWERDNS_POSTGRES_USERNAME}}" }}
    gpgsql-dbname={{ printf "{{POWERDNS_POSTGRES_DATABASE}}" }}
    gpgsql-password={{ printf "{{POWERDNS_POSTGRES_PASSSWORD}}" }}
