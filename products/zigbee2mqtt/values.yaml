replicas: 1

revisionHistoryLimit: 0

image:
  registry: docker.io
  repository: koenkk/zigbee2mqtt
  tag: 1.35.1

resources:
  limits:
    device.local/zigbee: 1
  requests:
    device.local/zigbee: 1

podSecurityContext:
#  runAsUser: 1001
#  runAsGroup: 1001
#  fsGroup: 1001
#  runAsNonRoot: true

securityContext:
#  allowPrivilegeEscalation: false
#  capabilities:
#    drop: [ "ALL" ]
#  readOnlyRootFilesystem: true
#  seccompProfile:
#    type: RuntimeDefault

persistence:
  accessMode: ReadWriteOnce
  size: 1Gi

ingress:
  enabled: true
  domain: zigbee.cloud.feddema.dev
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-dns
    nginx.ingress.kubernetes.io/auth-url: |-
      http://ak-outpost-authentik-embedded-outpost.authentik.svc.cluster.local:9000/outpost.goauthentik.io/auth/nginx
    nginx.ingress.kubernetes.io/auth-signin: |-
      https://zigbee.cloud.feddema.dev/outpost.goauthentik.io/start?rd=$escaped_request_uri
    nginx.ingress.kubernetes.io/auth-response-headers: |-
      Set-Cookie,X-authentik-username,X-authentik-groups,X-authentik-email,X-authentik-name,X-authentik-uid
    nginx.ingress.kubernetes.io/auth-snippet: |
      proxy_set_header X-Forwarded-Host $http_host;
  tls:
    - hosts:
        - zigbee.cloud.feddema.dev
      secretName: zigbee2mqtt-tls

nodeSelector:
  sonoff.tech/zigbee-dongle-plus-e: "true"

config:
  image:
    registry: docker.io
    repository: busybox
    tag: 1.36.1

  secretName: zigbee2mqtt-credentials

  fileContent:
    permit_join: false
    availability: true
    homeassistant:
      discovery_topic: homeassistant
      status_topic: hass/status
      legacy_entity_attributes: false
      legacy_triggers: false
    mqtt:
      version: 5
      base_topic: zigbee2mqtt
      server: '!secret.yaml mqtt_server'
      user: '!secret.yaml mqtt_user'
      password: '!secret.yaml mqtt_password'
    serial:
      port: /dev/ttyACM0
      adapter: ezsp
    frontend:
      port: 8080
      url: https://zigbee.cloud.feddema.dev
    advanced:
      network_key: '!secret.yaml advanced_network_key'
      pan_id: 23016
      ext_pan_id: [195, 192, 116, 85, 33, 65, 21, 93]
      legacy_api: false
      legacy_availability_payload: false
