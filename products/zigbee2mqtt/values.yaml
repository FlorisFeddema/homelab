replicas: 1

revisionHistoryLimit: 0

image:
  registry: docker.io
  repository: koenkk/zigbee2mqtt
  tag: 1.35.3

resources:
  limits:
    device.local/zigbee: 1
  requests:
    device.local/zigbee: 1

podSecurityContext:
#  runAsUser: 1001
#  runAsGroup: 1001
#  fsGroup: 1001
#  runAsNonRoot: true

securityContext:
#  allowPrivilegeEscalation: false
#  capabilities:
#    drop: [ "ALL" ]
#  readOnlyRootFilesystem: true
#  seccompProfile:
#    type: RuntimeDefault

persistence:
  accessMode: ReadWriteOnce
  size: 1Gi

ingress:
  enabled: true
  domain: zigbee.feddema.dev
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-dns
    nginx.ingress.kubernetes.io/auth-url: |-
      http://ak-outpost-authentik-embedded-outpost.authentik.svc.cluster.local:9000/outpost.goauthentik.io/auth/nginx
    nginx.ingress.kubernetes.io/auth-signin: |-
      https://zigbee.feddema.dev/outpost.goauthentik.io/start?rd=$escaped_request_uri
    nginx.ingress.kubernetes.io/auth-response-headers: |-
      Set-Cookie,X-authentik-username,X-authentik-groups,X-authentik-email,X-authentik-name,X-authentik-uid
    nginx.ingress.kubernetes.io/auth-snippet: |
      proxy_set_header X-Forwarded-Host $http_host;
  tls:
    enabled: true
    secretName: zigbee2mqtt-tls

nodeSelector:
  sonoff.tech/zigbee-dongle-plus-e: "true"

config:
  image:
    registry: docker.io
    repository: busybox
    tag: 1.36.1

  createFiles:
    - devices.yaml
    - groups.yaml

  secret:
    name: zigbee2mqtt-credentials
    # key is secret.yaml, if no value is given the sealedSecret is not created
    sealedValues:
      secretYaml: AgAKjayuQxVG7zVtxKUwKiODlcSlmyH2B/EpBk1ZGvp7xtMPefc7hkspa8QSb+VpSX4y6mLv56jWHSA3H5J4LvwAAL7lu3EvT9FaRv/8wFM4hqLfV1rFknnFBnsNbhC2wIUlBEaicC1LpHg5bCiRmOAFZ98voXsKyJ2qYgGOe9wmzkX7LBk+jX94lobGIh9DNGRdsWCmAmpXHf5AAIyagOu5MGPnI5HR3DzdkSV3FKuES0i4O1pco5ojAMI5OE0kOEq9TnbeFIJ9OHPb02zUuVdbVOoanQnaXvRxhaMVIWtHCzsOGjDHKjQvGu22MuuimPBHSXdQgXVRHF+ZrjCruVxO1KO0RMl2458TVRaoIMQ8De2/q/qzRUQ9kYQY6EPU4NPWAl48eZOHpYWEZ5NJVF9oICg5crqn3+qfK69cnNxHrXw3zPsu3fIDjSP6SH6GtHMfk6H+KGR0u0hqIBY5eMJdTRyD1HDlzCQuPLodbEHovTkukybp740NcfTO0e2k5kpvf1aqYoFtt4Dc83UfFbQaSBTHQjO0cMheTqSNVUDFRM5psn06YH6z+uLENEIQl1fNbehb2NPwlbtQ7uq6l/YjyBhPACp+3IwKbiXTV7G5UYDnzWU+7YF6vVuFn+5PxPY7tuYU16nqpBwE0GLZgKLBtrRxX3OWMxVD+L3fM3EjhHU1D/erzSBsJg0bs7csDWsk62hSO32UaXrYvufhzriOJVVox9FzDXaNaJjm7pkc8WyNVezkcKswEg6lfTGuetKv3LjJ08e2mEHWrDXq52LUo3Hy5QAWVlj7WbAIpnVVnGarTgXh9YISgqNP2RRUs1/Rgzh/buVY1FaOS8JUyT5zNQwMxP4S7L0orY8ebWbfWoTLCjxpRHzO6uUIm41oXUoPd6Au9w21dvZKsHyAL9DC82oxil8AM5rDBpGgGU/J/MyFHw5X2G1Eg3R0lhgYXeckPjm0MBoCJZe/i+4YpLCrMdvx0e2ZBBZt5IlGvHMlv2OhHcnbDME/9pJS8rFAkNt0hMN4IXNC

  fileContent:
    devices: devices.yaml
    groups: groups.yaml
    permit_join: false
    availability: true
    homeassistant:
      discovery_topic: homeassistant
      status_topic: hass/status
      legacy_entity_attributes: false
      legacy_triggers: false
    mqtt:
      version: 5
      base_topic: zigbee2mqtt
      server: '!secret.yaml mqtt_server'
      user: '!secret.yaml mqtt_user'
      password: '!secret.yaml mqtt_password'
    serial:
      port: /dev/ttyACM0
      adapter: ezsp
    frontend:
      port: 8080
      url: https://zigbee.feddema.dev
    advanced:
      network_key: '!secret.yaml advanced_network_key'
      pan_id: 23016
      ext_pan_id: [195, 192, 116, 85, 33, 65, 21, 93]
      legacy_api: false
      legacy_availability_payload: false
