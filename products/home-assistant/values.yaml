replicas: 1

image:
  registry: ghcr.io
  repository: home-assistant/home-assistant
  tag: 2024.1.2

resources: {}

deploymentStrategy:
  type: Recreate

podSecurityContext:
#  runAsUser: 1000
#  runAsGroup: 1000
#  fsGroup: 1000
#  runAsNonRoot: true

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop: [ "ALL" ]
    add: ["NET_RAW", "NET_BIND_SERVICE"]
#  readOnlyRootFilesystem: true

persistence:
  accessMode: ReadWriteOnce
  size: 5Gi

extraPorts:
  - name: homekit
    containerPort: 21064
    protocol: TCP
  - name: homekit-1
    containerPort: 5353
    protocol: UDP
  - name: homekit-2
    containerPort: 21063
    protocol: TCP

loadBalancer:
  enabled: true
  annotations:
    "io.cilium/lb-ipam-ips": "192.168.100.200"
    kubelish/service-name: Hap
    kubelish/service-type: _hap._tcp
  ports:
    - name: http
      port: 8123
      targetPort: 8123
      protocol: TCP
    - name: homekit
      port: 21064
      targetPort: 21064
      protocol: TCP
    - name: homekit-1
      port: 5353
      targetPort: 5353
      protocol: TCP
    - name: homekit-2
      port: 21063
      targetPort: 21063

ingress:
  enabled: true
  domain: home.cloud.feddema.dev
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-dns
#    nginx.ingress.kubernetes.io/auth-url: |-
#      http://ak-outpost-authentik-embedded-outpost.authentik.svc.cluster.local:9000/outpost.goauthentik.io/auth/nginx
#    nginx.ingress.kubernetes.io/auth-signin: |-
#      https://home.cloud.feddema.dev/outpost.goauthentik.io/start?rd=$escaped_request_uri
#    nginx.ingress.kubernetes.io/auth-response-headers: |-
#      Set-Cookie,X-authentik-username,X-authentik-groups,X-authentik-email,X-authentik-name,X-authentik-uid
#    nginx.ingress.kubernetes.io/auth-snippet: |
#      proxy_set_header X-Forwarded-Host $http_host;


config:
  image:
    registry: docker.io
    repository: busybox
    tag: 1.36.1

  createFiles:
    - customize.yaml
    - automations.yaml
    - scripts.yaml
    - scenes.yaml
    - sensors.yaml
    - groups.yaml

  secretName: home-assistant-secret

  configurationYaml: |
    # Loads default set of integrations. Do not remove.
    default_config:
    homeassistant:
      name: Home
      unit_system: metric
      temperature_unit: C
      currency: EUR
      external_url: https://home.cloud.feddema.dev
      customize: !include customize.yaml
      language: en
      country: NL

    logger:
      default: warning
      logs:
        homeassistant.components.homekit: debug
        pyhap: debug

    http:
      use_x_forwarded_for: true
      trusted_proxies:
        - 10.0.0.0/8
    
    
    recorder:
      db_url: !secret recorder_db_url
    
    auth_header:
      username_header: X-authentik-username
  
    tts:
      - platform: google_translate
    
    automation: !include automations.yaml
    script: !include scripts.yaml
    scene: !include scenes.yaml
    sensor: !include sensors.yaml
    group: !include groups.yaml
