replicas: 1

image:
  registry: ghcr.io
  repository: home-assistant/home-assistant
  tag: 2024.1.3

resources: {}

deploymentStrategy:
  type: Recreate

podSecurityContext:

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop: [ "ALL" ]
    add: ["NET_RAW", "NET_BIND_SERVICE"]

persistence:
  accessMode: ReadWriteOnce
  size: 5Gi

ingress:
  enabled: true
  domain: home.cloud.feddema.dev
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-dns
#    nginx.ingress.kubernetes.io/auth-url: |-
#      http://ak-outpost-authentik-embedded-outpost.authentik.svc.cluster.local:9000/outpost.goauthentik.io/auth/nginx
#    nginx.ingress.kubernetes.io/auth-signin: |-
#      https://home.cloud.feddema.dev/outpost.goauthentik.io/start?rd=$escaped_request_uri
#    nginx.ingress.kubernetes.io/auth-response-headers: |-
#      Set-Cookie,X-authentik-username,X-authentik-groups,X-authentik-email,X-authentik-name,X-authentik-uid
#    nginx.ingress.kubernetes.io/auth-snippet: |
#      proxy_set_header X-Forwarded-Host $http_host;


config:
  image:
    registry: docker.io
    repository: busybox
    tag: 1.36.1

  createFiles:
    - customize.yaml
    - automations.yaml
    - scripts.yaml
    - scenes.yaml
    - sensors.yaml
    - known_devices.yaml
    - mqtt_sensors.yaml
    - binary_sensors.yaml
    - groups.yaml

  secretName: home-assistant-secret

  configurationYaml: |
    # Loads default set of integrations. Do not remove.
    default_config:
    homeassistant:
      name: Home
      unit_system: metric
      temperature_unit: C
      currency: EUR
      external_url: https://home.cloud.feddema.dev
      customize: !include customize.yaml
      language: en
      country: NL
      packages: !include_dir_named packages

    proximity:
      home_tesla:
        zone: home
        devices:
          - device_tracker.tesla_location
        tolerance: 10
        unit_of_measurement: km

    http:
      use_x_forwarded_for: true
      trusted_proxies:
        - 10.0.0.0/8
    
    afvalbeheer:
      wastecollector: MijnAfvalwijzer
      resources:
        - restafval
        - gft
        - papier
      postcode: 5628AN
      streetnumber: 50
    
    homekit:
      name: Home Assistant Bridge
      mode: bridge
      advertise_ip: 192.168.1.101
      port: 21064
    
    recorder:
      db_url: !secret recorder_db_url
    
    auth_header:
      username_header: X-authentik-username
  
    tts:
      - platform: google_translate

    mqtt: !include mqtt_sensors.yaml
    binary_sensor: !include binary_sensors.yaml
    automation: !include automations.yaml
    script: !include scripts.yaml
    scene: !include scenes.yaml
    sensor: !include sensors.yaml
    group: !include groups.yaml
