minio:
  mode: standalone
  existingSecret: "minio-credentials"

  drivesPerNode: 1
  replicas: 1
  pools: 1

  persistence:
    enabled: true
    accessMode: ReadWriteOnce
    size: 500Gi

  service:
    type: ClusterIP
    clusterIP: ~
    port: "9000"

  ingress:
    enabled: false

  consoleIngress:
    enabled: true
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-dns
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    path: /
    hosts:
      - minio.cloud.feddema.dev
    tls:
      - secretName: minio-tls
        hosts:
          - minio.cloud.feddema.dev

  resources:
    requests:
      memory: 256Mi
      cpu: 50m

  oidc:
    enabled: true
    configUrl: "https://authentik.cloud.feddema.dev/application/o/minio/.well-known/openid-configuration"
    clientId: "xdEQir8pxCMgVYuKfMIx0yYy2CBorFRPvYhdvJ9C"
    existingClientSecretName: "minio-oidc-credentials"
    existingClientSecretKey: "clientSecret"
    scopes: "openid,profile,email,minio"
    claimName: "policy"

# Fixed in version >5.0.14
#    redirectUri: "https://minio.cloud.feddema.dev/oauth_callback"

  environment:
    MINIO_IDENTITY_OPENID_REDIRECT_URI: "https://minio.cloud.feddema.dev/oauth_callback"

  users:
    - accessKey: loki
      existingSecret: loki-credentials
      existingSecretKey: secretKey
      policy: readwrite

  buckets:
    - name: loki-chunks
      policy: none
      purge: false
      versioning: false
    - name: loki-ruler
      policy: none
      purge: false
      versioning: false
    - name: loki-admin
      policy: none
      purge: false
      versioning: false

  metrics:
    serviceMonitor:
      enabled: true
      includeNode: true
